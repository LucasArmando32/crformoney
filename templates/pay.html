{% extends "layout.html" %}
{% block title %} Payment {% endblock title%}

{% block content %}
  <h1>Payment</h1>
  <h2>How It Works</h2>

  <ul>
    <li>Choose an entry between <strong>2–5 CHF</strong> per match.</li>
    <li>If you <strong>win</strong>, your payout is <strong>1.75×</strong> your entry.</li>
    <li>If you <strong>lose</strong>, you lose your full entry.</li>
    <li>Limit: <strong>3 matches per day</strong> per player.</li>
  </ul>

  <h2>With Twint: 076 532 73 56</h2>
  
  <h2>With PayPal:</h2>
<div id="paypal-button-container"></div>

<!-- SDK EINMAL laden -->
<script
  src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=CHF&debug=true"
  data-sdk-integration-source="crformoney"
  defer>
</script>

<script>
  window.addEventListener('DOMContentLoaded', function () {
    console.log("PAYPAL_CLIENT_ID:", "{{ paypal_client_id|e }}");
    if (!window.paypal) {
      console.error("PayPal SDK not loaded.");
      return;
    }
    paypal.Buttons({
      createOrder: function (data, actions) {
        return actions.order.create({
          purchase_units: [{ amount: { value: '5.00' } }]
        });
      },
      onApprove: function (data, actions) {
        return actions.order.capture().then(function (details) {
          alert('Payment completed by ' + details.payer.name.given_name);
          window.location.href = "{{ url_for('home') }}";
        });
      },
      onError: function (err) {
        console.error("PayPal onError:", err);
        alert("PayPal error. Check console/network logs.");
      }
    }).render('#paypal-button-container');
  });
</script>

{% if not paypal_client_id %}
  <p style="color:red">Server misconfigured: PAYPAL_CLIENT_ID is missing on production.</p>
{% endif %}

  

  <p style="font-size:.95em;color:#555;">
    Examples: 2 CHF → 3.50 CHF if you win; 3 CHF → 5.25 CHF; 5 CHF → 8.75 CHF.
  </p>

  <form action="{{ url_for('home') }}" method="get" style="margin-top:20px;">
    <button type="submit">Payment Done</button>
  </form>
{% endblock content %}
